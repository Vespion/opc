name: Pull Request Tasks

on:
  pull_request:
    branches:
      - main

permissions:
  contents: read

jobs:
  testing:
    name: Tests
    uses: ./tests.yaml
    strategy:
      fail-fast: false
      matrix:
        node: [14.6, 16, 18, lts]
    with:
      node-version: ${{ matrix.node }}

  linting:
    name: Linting and Style checks
    runs-on: ubuntu-latest
    permissions:
      contents: read
      checks: write
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Install Node.js
        id: node-setup
        uses: actions/setup-node@v3
        with:
          node-version: "*"
          cache: pnpm

      - name: Setup PNPM
        uses: pnpm/action-setup@v2

      - name: Install Dependencies
        run: pnpm install --frozen-lockfile

      - name: Lint
        uses: reviewdog/action-eslint@v1
        with:
          reporter: github-pr-check,github-pr-review
          level: error
          reviewdog_flags: -name=eslint

      - name: Style
        uses: EPMatt/reviewdog-action-prettier@v1
        with:
            reporter: github-pr-review
            level: warning

      - name: Alex
        uses: reviewdog/action-alex@v1
        with:
          reporter: github-pr-review
          level: warning
          reviewdog_flags: -name=alex